%script{:type => 'text/javascript', :src => 'https://js.stripe.com/v1/'}

%fieldset#credit_card_swipe
  %legend Credit Card Payment
  - fields_for :credit_card, credit_card do |cc|
    = hidden_field_tag 'credit_card_token'
    = hidden_field_tag '_stripe_api_key', Option.value(:stripe_publishable_key)

    = label :credit_card, :verification_value, 'Enter CVV code manually FIRST!', :class => 'strong'
    = cc.text_field 'verification_value', :size => 4, :max_length => 4, :autocomplete => :off, :class => 'fieldWithErrors'
    = make_unsubmitted 'credit_card_verification_value'
    %br
    %div Then type in card data, or
    %br
    #ccReady= link_to_function 'Click Here to Swipe Card', 'waitForSwipe()', {:class => 'genButton'}
    #ccWaiting{:style => 'display: none;'}= link_to_function 'Swipe Card or Click Here to Cancel', 'resetSwipe()', {:class => 'genButton'}
    = text_field_tag 'swipe_data', '', {:style => 'position: absolute; left: -10000px; top: auto; overflow: hidden;'}
    %br
    %br
    = label :credit_card, :first_name, 'First Name'
    = cc.text_field :first_name, :size => 20
    %br
    = label :credit_card, :last_name, 'Last Name'
    = cc.text_field :last_name, :size => 20
    %br
    = label :credit_card, :number, 'Number (no spaces)'
    = cc.text_field :number, :size => 20, :max_length => 16, :autocomplete => :off
    = make_unsubmitted 'credit_card_number'
    %br
    - dt = Date.civil(credit_card.year || Date.today.year, |
      credit_card.month || Date.today.month) |
    = label :credit_card, :month, 'Expiration Month'
    = select_month dt, :add_month_numbers => true,:prefix => 'credit_card', :id => 'credit_card_month'
    = make_unsubmitted 'credit_card_month'
    %br
    = label :credit_card, :year, 'Expiration Year'
    = select_year dt, :start_year => dt.year, :end_year => dt.year + 6, :prefix => 'credit_card'
    = make_unsubmitted 'credit_card_year'
    %br
  %br
